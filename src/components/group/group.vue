<template>    <div class="modal-group">        <b-modal            id="modal-prevent-group"            ref="modal"            size= "lg"            title="Create a new Group Chat"            @show="resetModal"            @hidden="resetModal"            @ok="handleOk">            <form ref="form" class="form-groups">                <div class="row">                    <div class="col-md-3">                         <div class="form-group">                            <label class="label-left">Category name:</label>                        </div>                    </div>                    <div class="col-md-9">                        <div class="form-group">                            <input type="hidden" name="userId" v-model="userId" class="form-control" >                            <input type="text" name="groupName" v-model="groupName" class="form-control" placeholder="Category name">                            <div class="error">{{groupNameError}}</div>                        </div>                    </div>                </div>                <div class="row">                    <div class="col-md-3">                        <div class="form-group">                            <label  class="label-left">Choose chat:</label>                        </div>                    </div>                    <div class="col-md-9">                        <div class="form-group searchRoom">                            <span class="icSearch">                                <svg viewBox="0 0 10 10" class="icSearch" width="16" height="16">                                    <use fill-rule="evenodd" xlink:href="#icon_search"></use>                                </svg>                            </span>                            <span class="inputSearch">                                <input type="text" id="ContactFilter" class="form-control" v-model="search" placeholder="Search by name">                            </span>                        </div>                    </div>                </div>                <div class="row">                    <div class="col-md-3">                    </div>                    <div class="col-md-9">                        <div class="form-group">                            <div class="MemberSelect">                                <div id="SelectAllBtn" class="memberTableCheckAll" >                                    <input id="checkAll" name="checkAll" type="checkbox" v-model="selectAll" @click="select">                                    <label for="checkAll" class="linkStatus" >                                        Number of selected chats: <b>{{selected.length}}</b>                                    </label>                                </div>                                <div class="table-scroll">                                    <table class="table table-group">                                        <tr v-for='item in filteredItems'>                                            <td width="5%"><input type="checkbox" :value="item.id" v-model="selected"></td>                                            <td width="10%" class="avatar">                                                <img v-bind:src="item.icon_img">                                            </td>                                            <td width="90%" class="persion">                                                <p class="member">                                                    <span class="name">{{item.name}}</span>                                                </p>                                            </td>                                        </tr>                                    </table>                                </div>                            </div>                            <div class="error">                                {{selectedError}}                            </div>                        </div>                    </div>                </div>            </form>            <div slot="modal-footer" class="w-100">                <b-button variant="outline-secondary"                  :disabled="!(selected.length > 0) || (groupName.length == 0) || disableButton" size="md" @click="btnCreate">{{buttonName}}</b-button>                <b-button variant="outline-secondary" size="md" @click="btnCancel"> Cancel </b-button>            </div>        </b-modal>    </div></template><style>    .modal-title{        font-weight: 600;    }    .modal-content{        background: #F7f7f7;    }    .form-group{        margin-bottom: 10px;;    }    .form-group input{        width: 50%;        display: inline-block;    }    .form-group label{        font-size: 13px;        font-weight: normal;        line-height: 18px;        color: #666666;    }    .form-groups .searchRoom{        position: relative;    }    .form-groups .searchRoom .icSearch{        position: absolute;        top: 5px;        left: 3px;    }    .searchRoom .inputSearch input{        padding-left: 30px;    }    .form-control {        font-size: 14px;    }    .form-group .error{        display: inline-block;        font-size: 12px;        color: red;    }    .form-group input[type="checkbox"]{        position: relative;        top: 1px;        width: 15px;        height: 15px;    }    .memberTableCheckAll{        justify-content: center;        border-style: solid;        border-width: 1px;        border-radius: 2px;        border-color: #b3b3b3;        text-decoration: none;        cursor: pointer;        padding: 5px 10px;        font-size: 13px;        background-color: #f5f5f4;        margin-right: 10px;        display: inline-block;        height: 30px;        width: 90%;    }    #checkAll{        position: relative;        top: 1px;    }    .memberTableCheckAll label{        margin-left: 3px;        position: relative;        top: -1px;    }    .table-scroll{        height: 300px;        overflow-y: scroll;        display: block;        border: 1px #b3b3b3 solid;        width: 90%;    }    .table-group tr{        width: 100%;    }    .table-group tr td{        padding: 10px;        padding-bottom: 0;        padding-top: 15px;    }    .table-group .avatar{        width: 40px;    }    .table-group .avatar img{        width: 20px;        height: auto;        position: relative;        top: -3px;    }    .modal-header {        padding: 10px 15px;    }    .modal-footer{        text-align: center;        padding: 10px 15px;    }    .form-group .label-left{        font-weight: bold;        position: relative;        top: 5px;        font-size: 16px;    }</style><script>    import modalMixin from '@/mixins/modal'    import axios from 'axios'    export default {        name: "Group",        mounted() {            this.$root.$on('open-modal-group', data => {                this.groupId = data;                this.items = [];                if(data != 0){                    this.selected = [];                    this.buttonName = "Update";                    this.getAllRooms().then(response => {                        this.items = response;                        this.getGroupById(data).then(response => {                            this.groupName = response.name;                        });                        this.getRoomByGroupId(data).then(response => {                            for (var i = 0; i < this.items.length; i++) {                                for (var j = 0; j < response.length; j++) {                                    if(this.items[i].id == response[j].id){                                        this.selected.push(this.items[i].id);                                        break;                                    }                                }                            }                            this.selectAll = (this.selected.length == this.items.length);                        });                    });                }else{                    this.groupName = '';                    this.selected = [];                    this.buttonName = "Create";                    this.getAllRooms().then(response => {                        this.items = response;                    });                }            });        },        data() {            return {                name: '',                nameState: null,                submittedNames: [],                isActive : false,                selectItem: "Edit all permissions",                subscriptions: [{id:1,name:'Admin'},{id:2,name:'Member'},{id:3,name:'Readonly'}],                activeIndex: undefined,                search: "",                items: [],                selected: [],                selectAll: false,                groupName: "",                userId: 1,                description: "",                groupId: 0,                groupNameError: "",                selectedError: "",                buttonName : "Create",                disableButton: false,            }        },        created: function(){        },        computed: {            filteredItems() {                if(this.items.length > 0){                    return this.items.filter(item => {                        return item.name.toLowerCase().indexOf(this.search.toLowerCase()) > -1                    });                }                return [];            }        },        methods: {            select() {                this.selected = [];                if (!this.selectAll) {                    for (let i in this.items) {                        this.selected.push(this.items[i].id);                    }                }            },            setActive(index, criptions) {                this.activeIndex = index;                this.selectItem = criptions;            },            getAllRooms(){                return axios.get("http://sns-api.local.vn:81/api/v1/group/getAllRooms", {                },{                    headers: {Accept: "application/json"}                }).then(function (response) {                    return response.data;                }).catch(function (error) {                    return null;                });            },            getGroupById(id){                return axios.get("http://sns-api.local.vn:81/api/v1/group/getGroupById/"+id, {                },{                    headers: {Accept: "application/json"}                }).then(function (response) {                    return response.data;                }).catch(function (error) {                    return null;                });            },            getRoomByGroupId(id){                return axios.get("http://sns-api.local.vn:81/api/v1/group/getRoomByGroupId/"+id, {                },{                    headers: {Accept: "application/json"}                }).then(function (response) {                    return response.data;                }).catch(function (error) {                    return null;                });            },            btnCancel(){                this.$refs.modal.hide();            },            checkFormValidity() {                if(this.groupName == "" || this.groupName.length >= 50){                    this.groupNameError = "Tên nhóm không rống và phải it hơn 50 ký tự";                    return false                }                if(this.selected.length == 0){                    this.selectedError = "Phải chọn ít nhất một Rooms";                    return false                }                return true;            },            btnCreate() {                this.disableButton = true;                if(this.groupId == 0){                    if (!this.checkFormValidity()) {                        return                    }                    var res = axios.post("http://sns-api.local.vn:81/api/v1/group/add", {                        groupName: this.groupName,                        userId: this.userId,                        selected: this.selected,                        only_token: true,                    },{                        //headers: {Authorization: "Bearer " + token}                    }).then(function (response) {                        return response;                    }).catch(function (error) {                        return error;                    });                    res.then(response => {                        switch(parseInt(response.data.error_code)){                            case 0:                                this.$refs.modal.hide();                                this.$root.$emit('push-notice', {message:'insert success', alert: 'alert-success'});                            break;                            case 1:                                this.groupNameError = response.data.error_msg;                                break;                            case 2:                                this.selectedError = response.data.error_msg;                                break;                            case 3:                               break;                            break;                            default:                            break                        }                        this.disableButton = false;                    });                }else{                    if (!this.checkFormValidity()) {                        return                    }                    var res = axios.post("http://sns-api.local.vn:81/api/v1/group/update", {                        id: this.groupId,                        groupName: this.groupName,                        userId: this.userId,                        selected: this.selected,                        only_token: true,                    },{                        //headers: {Authorization: "Bearer " + token}                    }).then(function (response) {                        return response;                    }).catch(function (error) {                        return error;                    });                    res.then(response => {                        switch(parseInt(response.data.error_code)){                            case 0:                               this.$refs.modal.hide();                               this.$root.$emit('push-notice', {message:'Update success', alert: 'alert-success'});                            break;                            case 1:                                this.groupNameError = response.data.error_msg;                                break;                            case 2:                                this.selectedError = response.data.error_msg;                                break;                            case 3:                               break;                            break;                            default:                            break                        }                        this.disableButton = false;                    });                }            },            resetModal() {                this.name = ''                this.nameState = null            },            handleOk(bvModalEvt) {                bvModalEvt.preventDefault()                this.handleSubmit()            },        }    }</script>